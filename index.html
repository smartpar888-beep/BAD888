<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Hub - Full System</title>
    
    <!-- 1. Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap');
        body { font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useMemo } = React;
        const { BarChart, Bar, XAxis, YAxis, ResponsiveContainer, Cell, LabelList } = window.Recharts;

        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // ==========================================
        // 1. ส่วนตั้งค่า (ใส่ค่าจริงของคุณที่นี่)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBRHvY1JwC9WtXjsiqHjaGIE08IW9UZ28k", // หากเว้นว่างไว้ ระบบจะใช้โหมด Demo (Mock Data)
            authDomain: "badminton-f29a7.firebaseapp.com",
            projectId: "badminton-f29a7",
            storageBucket: "badminton-f29a7.firebasestorage.app",
            messagingSenderId: "880213955717",
            appId: "1:880213955717:web:ca8ab9ae8a495fae0145ec"
        };

        const MASTER_PIN = "1234";
        const APP_ID = "badminton_v1";
        // ==========================================

        const isConfigValid = firebaseConfig.apiKey && firebaseConfig.apiKey !== "YOUR_API_KEY";

        // SVG Icons
        const Icon = ({ name, size = 20, className="" }) => {
            const icons = {
                dashboard: <path d="M3 3h7v9H3V3zm11 0h7v5h-7V3zm0 9h7v9h-7v-9zM3 16h7v5H3v-5z"/>,
                plus: <path d="M12 5v14M5 12h14"/>,
                history: <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>,
                settings: <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-13c-1.1 0-2 .9-2 2v.2a.5.5 0 0 1-.3.4l-1.3.8a.5.5 0 0 1-.6-.2l-1.3-.8a2 2 0 0 0-2.7 2.7l.8 1.3a.5.5 0 0 1-.2.6l-.8 1.3c-.5 1 .2 2.2 1.3 2.7l1.3-.8a.5.5 0 0 1 .6.2l1.3.8c.2.4.2.9.2 1.3v.2c0 1.1.9 2 2 2s2-.9 2-2v-.2a.5.5 0 0 1 .3-.4l1.3-.8a.5.5 0 0 1 .6.2l1.3.8c1 .5 2.2-.2 2.7-1.3l-.8-1.3a.5.5 0 0 1 .2-.6l.8-1.3a2 2 0 0 0-2.7-2.7l-.8-1.3a.5.5 0 0 1-.2-.6l.8-1.3c.5-1-.2-2.2-1.3-2.7l-1.3.8a.5.5 0 0 1-.6-.2l-1.3-.8A2.1 2.1 0 0 0 12 2z"/>,
                trash: <path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>,
                user: <g><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></g>,
                court: <g><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 12h18"/><path d="M12 3v18"/></g>,
                shuttle: <g><path d="M12 2l-4 4v10l4 4 4-4V6z"/><path d="M8 10h8"/></g>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        function App() {
            const [isDemo, setIsDemo] = useState(!isConfigValid);
            const [user, setUser] = useState(isConfigValid ? null : { uid: 'demo-user' });
            const [activeTab, setActiveTab] = useState('dashboard');
            
            // Data States
            const [players, setPlayers] = useState(['A', 'B', 'C', 'D']);
            const [usageLogs, setUsageLogs] = useState([]);
            const [stockLogs, setStockLogs] = useState([]);
            const [courtLogs, setCourtLogs] = useState([]);

            // Form States
            const [selectedPlayers, setSelectedPlayers] = useState([]);
            const [shuttleCount, setShuttleCount] = useState('');
            const [stockQty, setStockQty] = useState('');
            const [stockPrice, setStockPrice] = useState('');
            const [stockBuyer, setStockBuyer] = useState('');
            const [courtFee, setCourtFee] = useState('');
            const [courtPayer, setCourtPayer] = useState('');
            const [newPlayerName, setNewPlayerName] = useState('');
            const [isDropdownOpen, setIsDropdownOpen] = useState(false);

            // Security States
            const [showPin, setShowPin] = useState(false);
            const [pinInput, setPinInput] = useState("");
            const [pendingAction, setPendingAction] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);

            // 1. Initialize Firebase & Sync
            useEffect(() => {
                if (!isConfigValid) {
                    console.warn("Firebase config missing. Running in DEMO mode.");
                    return;
                }

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                signInAnonymously(auth).catch(err => console.error("Auth Error:", err));
                
                const unsubscribeAuth = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    if (u) {
                        const unsubUsage = onSnapshot(collection(db, 'apps', APP_ID, 'usage'), s => 
                            setUsageLogs(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b)=>b.timestamp-a.timestamp)));
                        const unsubStock = onSnapshot(collection(db, 'apps', APP_ID, 'stock'), s => 
                            setStockLogs(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b)=>b.timestamp-a.timestamp)));
                        const unsubCourt = onSnapshot(collection(db, 'apps', APP_ID, 'court'), s => 
                            setCourtLogs(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b)=>b.timestamp-a.timestamp)));
                        const unsubMembers = onSnapshot(doc(db, 'apps', APP_ID, 'config', 'members'), d => 
                            setPlayers(d.exists() ? d.data().list : ['A', 'B']));
                        
                        return () => { unsubUsage(); unsubStock(); unsubCourt(); unsubMembers(); };
                    }
                });

                return () => unsubscribeAuth();
            }, []);

            // 2. Calculations
            const stats = useMemo(() => {
                const totalStockQty = stockLogs.reduce((s, i) => s + Number(i.quantity || 0), 0);
                const totalStockCost = stockLogs.reduce((s, i) => s + Number(i.price || 0), 0);
                const avgPrice = totalStockQty > 0 ? totalStockCost / totalStockQty : 35; // Default 35 if no stock
                const totalUsed = usageLogs.reduce((s, i) => s + Number(i.shuttleCount || 0), 0);
                
                const balance = {};
                players.forEach(p => balance[p] = 0);

                usageLogs.forEach(log => {
                    const ps = log.players || [];
                    if (ps.length > 0) {
                        const cost = (Number(log.shuttleCount) * avgPrice) / ps.length;
                        ps.forEach(p => { if (balance[p] !== undefined) balance[p] += cost; });
                    }
                });

                courtLogs.forEach(log => {
                    const members = log.membersAtTime || [];
                    if (members.length > 0) {
                        const fee = Number(log.fee) / members.length;
                        members.forEach(p => { if (balance[p] !== undefined) balance[p] += fee; });
                    }
                });

                stockLogs.forEach(log => { if (balance[log.buyer] !== undefined) balance[log.buyer] -= Number(log.price); });
                courtLogs.forEach(log => { if (balance[log.payer] !== undefined) balance[log.payer] -= Number(log.fee); });

                const chartData = Object.keys(balance).map(name => ({
                    name, 
                    expense: Math.round(balance[name])
                })).sort((a,b) => b.expense - a.expense);

                return { currentStock: totalStockQty - totalUsed, avgPrice, chartData };
            }, [players, usageLogs, stockLogs, courtLogs]);

            // 3. Actions
            const requestPin = (action) => {
                if (isAdmin) { action(); return; }
                setPendingAction(() => action);
                setShowPin(true);
            };

            const submitPin = (e) => {
                e.preventDefault();
                if (pinInput === MASTER_PIN) {
                    setIsAdmin(true);
                    if (pendingAction) pendingAction();
                    setShowPin(false);
                    setPinInput("");
                } else {
                    alert("รหัส PIN ไม่ถูกต้อง");
                    setPinInput("");
                }
            };

            const saveData = async (type) => {
                const data = {
                    timestamp: Date.now(),
                    date: new Date().toLocaleDateString('th-TH')
                };

                if (isDemo) {
                    // Demo Mode logic: Update local state
                    if (type === 'usage') setUsageLogs([{...data, id: Math.random(), shuttleCount, players: selectedPlayers}, ...usageLogs]);
                    if (type === 'stock') setStockLogs([{...data, id: Math.random(), quantity: stockQty, price: stockPrice, buyer: stockBuyer}, ...stockLogs]);
                    if (type === 'court') setCourtLogs([{...data, id: Math.random(), fee: courtFee, payer: courtPayer, membersAtTime: players}, ...courtLogs]);
                    setActiveTab('dashboard');
                    return;
                }

                // Firebase Mode logic
                const db = getFirestore();
                if (type === 'usage') {
                    await addDoc(collection(db, 'apps', APP_ID, 'usage'), { ...data, shuttleCount: Number(shuttleCount), players: selectedPlayers });
                    setShuttleCount(''); setSelectedPlayers([]);
                } else if (type === 'stock') {
                    await addDoc(collection(db, 'apps', APP_ID, 'stock'), { ...data, quantity: Number(stockQty), price: Number(stockPrice), buyer: stockBuyer });
                    setStockQty(''); setStockPrice('');
                } else if (type === 'court') {
                    await addDoc(collection(db, 'apps', APP_ID, 'court'), { ...data, fee: Number(courtFee), payer: courtPayer, membersAtTime: players });
                    setCourtFee('');
                }
                setActiveTab('dashboard');
            };

            if (!user && isConfigValid) {
                return <div className="flex items-center justify-center min-h-screen">กำลังเชื่อมต่อฐานข้อมูล...</div>;
            }

            return (
                <div className="min-h-screen pb-24 max-w-md mx-auto bg-white shadow-xl overflow-hidden relative">
                    {isDemo && (
                        <div className="bg-amber-500 text-white text-[10px] text-center font-bold py-1">
                            DEMO MODE (ไม่ได้เชื่อมต่อ Firebase)
                        </div>
                    )}
                    
                    <header className="bg-indigo-600 p-4 text-white flex justify-between items-center sticky top-0 z-20 shadow-md">
                        <div>
                            <h1 className="font-bold text-lg italic tracking-widest uppercase">Badminton Hub</h1>
                            <p className="text-[10px] opacity-70">SQUAD MANAGER v4.1</p>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="bg-indigo-700 px-3 py-1 rounded-full text-xs font-bold border border-indigo-500">
                                คลัง: {stats.currentStock}
                            </div>
                            <button onClick={()=>setActiveTab('settings')} className="p-2 bg-indigo-500 rounded-full hover:bg-indigo-400 transition">
                                <Icon name="settings" className="text-white"/>
                            </button>
                        </div>
                    </header>

                    <main className="p-4 space-y-6">
                        {activeTab === 'dashboard' && (
                            <div className="fade-in space-y-4">
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-slate-100 p-4 rounded-2xl border border-slate-200">
                                        <p className="text-xs text-slate-500 font-bold uppercase">ราคาเฉลี่ย/ลูก</p>
                                        <p className="text-2xl font-black text-slate-800">{stats.avgPrice.toFixed(1)} ฿</p>
                                    </div>
                                    <div className="bg-indigo-50 p-4 rounded-2xl border border-indigo-100">
                                        <p className="text-xs text-indigo-500 font-bold uppercase">หนี้รวม</p>
                                        <p className="text-2xl font-black text-indigo-700">
                                            {stats.chartData.reduce((a,b) => a + (b.expense > 0 ? b.expense : 0), 0)} ฿
                                        </p>
                                    </div>
                                </div>

                                <div className="bg-white p-4 rounded-3xl border border-slate-200 shadow-sm">
                                    <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2 text-sm uppercase tracking-wide">
                                        <div className="w-1.5 h-4 bg-indigo-500 rounded-full"></div> สรุปยอดค้างชำระ
                                    </h3>
                                    <div className="h-[400px]">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={stats.chartData} layout="vertical" margin={{left: -20, right: 35}}>
                                                <XAxis type="number" hide />
                                                <YAxis dataKey="name" type="category" axisLine={false} tickLine={false} width={80} tick={{fontSize: 12, fontWeight: 700, fill: '#64748b'}} />
                                                <Bar dataKey="expense" radius={[0, 10, 10, 0]} barSize={24}>
                                                    {stats.chartData.map((e, i) => <Cell key={i} fill={e.expense > 0 ? '#6366f1' : '#10b981'} />)}
                                                    <LabelList dataKey="expense" position="right" style={{fontSize: 11, fontWeight: 'bold'}} formatter={(v) => `${v}.-`} />
                                                </Bar>
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'input' && (
                            <div className="fade-in space-y-6">
                                <div className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-lg relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-2 bg-indigo-500"></div>
                                    <h3 className="font-bold text-indigo-600 mb-4 flex items-center gap-2"><Icon name="shuttle"/> ลงค่าลูกแบด</h3>
                                    <div className="space-y-3">
                                        <button onClick={() => setIsDropdownOpen(!isDropdownOpen)} className="w-full p-4 bg-slate-50 rounded-2xl text-left font-bold text-sm flex justify-between border border-slate-200">
                                            {selectedPlayers.length > 0 ? `เลือกแล้ว ${selectedPlayers.length} คน` : "เลือกสมาชิกที่เล่น..."}
                                            <span className="text-slate-400">{isDropdownOpen ? '▲' : '▼'}</span>
                                        </button>
                                        {isDropdownOpen && (
                                            <div className="grid grid-cols-2 gap-2 p-2 bg-slate-100 rounded-2xl border mb-2">
                                                {players.map(p => (
                                                    <button key={p} onClick={() => setSelectedPlayers(prev => prev.includes(p) ? prev.filter(x => x !== p) : [...prev, p])}
                                                        className={`p-2 rounded-xl text-xs font-bold transition-all ${selectedPlayers.includes(p) ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-500 border border-slate-200'}`}>
                                                        {p}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                        <input type="number" placeholder="จำนวนลูกที่ใช้" value={shuttleCount} onChange={e => setShuttleCount(e.target.value)} className="w-full p-4 bg-slate-50 rounded-2xl font-bold border border-slate-200 outline-none text-lg" />
                                        <button onClick={() => { if(!shuttleCount || !selectedPlayers.length) return; saveData('usage'); }} className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition">บันทึกรายการ</button>
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-lg relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-2 bg-emerald-500"></div>
                                    <h3 className="font-bold text-emerald-600 mb-4 flex items-center gap-2"><Icon name="court"/> ลงค่าสนาม</h3>
                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input type="number" placeholder="ค่าสนามรวม" value={courtFee} onChange={e => setCourtFee(e.target.value)} className="w-full p-3 bg-slate-50 rounded-xl font-bold outline-none border border-slate-200" />
                                        <select value={courtPayer} onChange={e => setCourtPayer(e.target.value)} className="w-full p-3 bg-slate-50 rounded-xl font-bold outline-none border border-slate-200">
                                            <option value="">ใครจ่าย?</option>
                                            {players.map(p => <option key={p} value={p}>{p}</option>)}
                                        </select>
                                    </div>
                                    <button onClick={() => { if(!courtFee || !courtPayer) return; requestPin(() => saveData('court')); }} className="w-full py-3 bg-emerald-600 text-white rounded-xl font-bold shadow-lg shadow-emerald-200">บันทึก</button>
                                </div>

                                <div className="bg-slate-800 p-6 rounded-[2rem] text-white shadow-xl">
                                    <h3 className="font-bold text-slate-200 mb-4 flex items-center gap-2 text-sm uppercase tracking-wide opacity-80"><Icon name="plus" size={16}/> สั่งลูกเข้าสต็อก</h3>
                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input type="number" placeholder="จำนวนลูก" value={stockQty} onChange={e => setStockQty(e.target.value)} className="p-3 bg-slate-700 rounded-xl outline-none font-bold text-white placeholder-slate-500" />
                                        <input type="number" placeholder="ราคาทั้งหมด" value={stockPrice} onChange={e => setStockPrice(e.target.value)} className="p-3 bg-slate-700 rounded-xl outline-none font-bold text-white placeholder-slate-500" />
                                    </div>
                                    <select value={stockBuyer} onChange={e => setStockBuyer(e.target.value)} className="w-full p-3 bg-slate-700 rounded-xl font-bold outline-none mb-3 text-slate-300">
                                        <option value="">ใครควักตังค์จ่าย?</option>
                                        {players.map(p => <option key={p} value={p}>{p}</option>)}
                                    </select>
                                    <button onClick={() => { if(!stockQty || !stockPrice || !stockBuyer) return; requestPin(() => saveData('stock')); }} className="w-full py-3 bg-slate-600 rounded-xl font-bold hover:bg-slate-500 transition">เพิ่มเข้าคลัง</button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="fade-in space-y-3 pb-10">
                                <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] px-2 mb-2">History Log</h3>
                                {[...usageLogs, ...courtLogs, ...stockLogs].length === 0 && <p className="text-center text-slate-400 py-10 italic">ยังไม่มีประวัติรายการ</p>}
                                {[...usageLogs, ...courtLogs, ...stockLogs].sort((a,b)=>b.timestamp-a.timestamp).map((log, idx) => (
                                    <div key={idx} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex justify-between items-center group">
                                        <div>
                                            <p className="text-[10px] font-bold text-slate-400">{log.date} • {log.shuttleCount ? 'Shuttle' : log.fee ? 'Court' : 'Stock'}</p>
                                            <p className="font-bold text-slate-700 text-sm">
                                                {log.shuttleCount ? `ใช้ ${log.shuttleCount} ลูก (${log.players.length} คน)` : 
                                                 log.fee ? `ค่าสนาม ${log.fee}.- (${log.payer})` : 
                                                 `ซื้อ ${log.quantity} ลูก (${log.price}.-)`}
                                            </p>
                                        </div>
                                        <button onClick={() => requestPin(async () => {
                                            if (isDemo) {
                                                if (log.shuttleCount) setUsageLogs(usageLogs.filter(l => l.id !== log.id));
                                                if (log.fee) setCourtLogs(courtLogs.filter(l => l.id !== log.id));
                                                if (log.quantity) setStockLogs(stockLogs.filter(l => l.id !== log.id));
                                                return;
                                            }
                                            const col = log.shuttleCount ? 'usage' : log.fee ? 'court' : 'stock';
                                            await deleteDoc(doc(getFirestore(), 'apps', APP_ID, col, log.id));
                                        })} className="text-slate-200 group-hover:text-red-400 transition-colors"><Icon name="trash" size={18}/></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="fade-in space-y-4">
                                <div className="bg-white p-6 rounded-[2rem] border shadow-sm">
                                    <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><Icon name="user" size={18}/> สมาชิกในกลุ่ม</h3>
                                    <div className="flex gap-2 mb-4">
                                        <input type="text" value={newPlayerName} onChange={e => setNewPlayerName(e.target.value)} placeholder="ชื่อเล่น..." className="flex-1 p-3 bg-slate-100 rounded-xl font-bold outline-none text-sm" />
                                        <button onClick={() => requestPin(async () => {
                                            if(!newPlayerName) return;
                                            const newList = [...players, newPlayerName];
                                            if(!isDemo) await setDoc(doc(getFirestore(), 'apps', APP_ID, 'config', 'members'), { list: newList });
                                            else setPlayers(newList);
                                            setNewPlayerName('');
                                        })} className="bg-indigo-600 text-white p-3 rounded-xl hover:bg-indigo-700"><Icon name="plus"/></button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        {players.map(p => (
                                            <div key={p} className="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                                                <span className="font-bold text-slate-600 text-xs">{p}</span>
                                                <button onClick={() => requestPin(async () => {
                                                    const newList = players.filter(n => n !== p);
                                                    if(!isDemo) await setDoc(doc(getFirestore(), 'apps', APP_ID, 'config', 'members'), { list: newList });
                                                    else setPlayers(newList);
                                                })} className="text-slate-300 hover:text-red-400"><Icon name="trash" size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="text-center text-[10px] font-bold text-slate-400 bg-slate-100 p-4 rounded-2xl border border-dashed border-slate-300">
                                    
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-xs bg-slate-900/95 backdrop-blur-xl p-2 rounded-[2.5rem] shadow-2xl flex justify-around border border-white/10 z-50">
                        {[
                            {id: 'dashboard', icon: 'dashboard'},
                            {id: 'input', icon: 'plus'},
                            {id: 'history', icon: 'history'},
                            {id: 'settings', icon: 'settings'}
                        ].map(t => (
                            <button key={t.id} onClick={() => setActiveTab(t.id)} className={`p-4 rounded-2xl transition-all duration-300 ${activeTab === t.id ? 'bg-indigo-600 text-white scale-110' : 'text-slate-400 hover:text-slate-200'}`}>
                                <Icon name={t.icon} />
                            </button>
                        ))}
                    </nav>

                    {showPin && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/80 backdrop-blur-md p-4">
                            <div className="bg-white p-8 rounded-[2.5rem] w-full max-w-xs text-center shadow-2xl fade-in">
                                <div className="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <Icon name="settings" className="text-indigo-600" size={32}/>
                                </div>
                                <h3 className="font-bold text-lg text-slate-800 mb-2">ยืนยันตัวตน</h3>
                                <p className="text-xs text-slate-400 mb-6 font-medium">กรุณาใส่รหัส PIN เพื่อดำเนินการต่อ</p>
                                <input type="password" value={pinInput} onChange={e => setPinInput(e.target.value)} className="w-full p-4 bg-slate-50 rounded-2xl text-center text-4xl tracking-[0.5em] outline-none mb-6 font-black border-2 border-slate-100 focus:border-indigo-500 transition-colors" autoFocus maxLength={4} />
                                <div className="flex gap-3">
                                    <button onClick={() => {setShowPin(false); setPinInput("");}} className="flex-1 py-4 text-slate-500 font-bold bg-slate-100 rounded-2xl active:scale-95 transition">ยกเลิก</button>
                                    <button onClick={submitPin} className="flex-1 py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition">ตกลง</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
